# Replication package
This repository contains a full replication package for the results presented in the paper below: 

> F. Formica, T. Fan, A. Rajhans, V. Pantelic, M. Lawford and C. Menghi, "Simulation-based Testing of Simulink Models with Test Sequence and Test Assessment Blocks," in IEEE Transactions on Software Engineering, doi: 10.1109/TSE.2023.3343753.

In particular, this repository contains:

* The folder `Models/`: contains 17 out of 18 models used for the evaluation of Research Questions RQ1, RQ2, RQ3, and the model under analysis for RQ4.
* The folder `src/`: contains two functions that allow to run S-Taliro using the same version as Hecate.
* The folder `TestResults/`: contains all the results presented in the Evaluation section of the paper.
* The function `analyzeResults.m`: extracts performance parameters for the given model and tool.
* The function `generateInputs.m`: generates input signals from the Hecate parameters coherent with the ones generated by the Test Sequence block.
* The function `runHecate.m`: runs Hecate using the given Setting file.
* The function `runSTaliro.m`: runs S-Taliro using the given Setting file.
* The function `testTranslation.m`: compares the output of the Test Assessment block and STL formula for randomly generated test cases.
* The script `analyze_TestTranslation.m`: reads all the data files relative to the Test Translation experiment and presents the results.
* The script `boxplot_ranksum`: computes the results shown in Table 5 of the paper, saves the boxplots of time and number of iterations (Figure 8), and performs some Wilcoxon ranksum statistical tests on the data.
* The script `failureComparison.m`: produces plots showing the input and output signals for six test cases (three for Hecate and three for S-Taliro) for the chosen model.

## How to install
To install S-Taliro and Hecate, check the guide in the `main` branch.

To properly run both Hecate and S-Taliro using the same installation, move the function `Compute_Robustness.m` from the `src\` folder to `src\robustness_Hecate\`.
The source functions for Hecate must be downloaded from the `main` branch and copied into this `src` folder.

S-Taliro requires compiled files to run. To compile the files, follow these instructions:

1. Check that you have a Matlab-compatible compiler installed on your machine. (visit this link: https://www.mathworks.com/support/requirements/supported-compilers.html)
2. Make the folder containing S-Taliro your working directory.
3. Run the following function:

```matlab
setup_staliro;
```

This process must be performed only once after downloading a clean copy of S-Taliro.

## How to Run
Given the large number of models, we set up scripts to automate the testing process. Each model has an associated Setting file, containing information about the system's properties and the test-case search method.

Some models may require additional Matlab toolboxes to run. For example, FS requires the Aerospace Blockset Toolbox.
 
Execute `runHecate`, `runSTaliro`, and `testTranslation` by providing the corresponding setting file for the model of interest. For example, in the MATLAB terminal Hecate and S-TALIRO can be executed for the AT model by using the following:

```matlab
runHecate('SettingAT',5);  
runSTaliro('SettingAT',5);
```

The testTranslation script can be run using:

```matlab
testTranslation('SettingAT',5);
```

## Models
Contains 17 different demo models prepared for Hecate, plus the one used in the case study.

* **AFC**: A controller for air-to-fuel ration in an engine.
* **AT**: Model of a car automatic transmission with gears 1 to 4
* **AT2**: A second variation of Automatic Transmission
* **CC**: Simulation of a system formed by five cars
* **EKF***: Extended Kalman Filter
* **EU**: A model that computes the rotation matrix given a set of Euler angles
* **FS**: A model of a damping system for wing oscillations
* **HEV**: A hybrid electric vehicle
* **HPS**: A model of a heat pump system controlling temperature in a room
* **NN**: Neural Network controller of a levitating magnet above an electromagnet
* **NNP**: General neural network predictor with two hidden layers
* **PM**: A model of the controller for a Pacemaker
* **SC**: Dynamic model of a steam condenser
* **ST**: A signal tracker with 3 available tracking modes
* **TL**: A traffic model of a crossroads, simulating traffic lights and cars
* **TUI**: A model that applies Tustin Integrator for flight control
* **WT**: A model of a wind turbine

**Note(*):** The model for EKF cannot be released to the public, so it is missing from the `Model` folder. The `TestResults` folder still contains the results obtained on this model.

## TestResults
The directory in which Hecate test results are saved. They are saved in a .mat format using the following convention: 
 
	<Tool>_<model>_<date>_<time>.mat
	
The three available tools are Hecate, S-TALIRO, and TestTranslation.

# Authors
The following authors contributed to the creation of Hecate:

* Federico Formica, McMaster University, Canada: `formicaf at mcmaster dot ca`
* Tony Fan, McMaster University, Canada
* Akshay Rajhans, MathWorks, USA
* Vera Pantelic, McMaster University, Canada
* Mark Lawford, McMaster University, Canada
* Claudio Menghi, McMaster University, Canada
